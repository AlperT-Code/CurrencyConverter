{% extends "base.html" %}
{% block content %}

<h2 class="text-center mb-4">ğŸ’± DÃ¶viz DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼</h2>

<form method="POST" class="row g-3 justify-content-center" id="convertForm">
    <div class="col-md-3">
        <input type="number" step="0.01" name="amount" class="form-control" placeholder="Miktar" required value="{{ amount }}">
    </div>
    <div class="col-md-3">
        <input type="text" name="base" id="baseInput" class="form-control" placeholder="Baz (Ã¶rn: USD)" required value="{{ base }}">
    </div>
    <div class="col-md-3">
        <input type="text" name="target" id="targetInput" class="form-control" placeholder="Hedef (Ã¶rn: TRY)" required value="{{ target }}">
    </div>
    <div class="col-md-2 d-grid">
        <button class="btn btn-custom">Ã‡evir</button>
    </div>
</form>

{% if result %}
    <div class="alert alert-success mt-4 text-center fs-5" role="alert">
        {{ result.text }}
    </div>

    <div class="text-center mt-3 d-flex justify-content-center gap-3 flex-wrap">
        <a href="/grafik/{{ result.base }}/{{ result.target }}" class="btn btn-outline-light btn-lg">
            ğŸ“ˆ {{ result.base }}/{{ result.target }} GrafiÄŸini GÃ¶r
        </a>
        <button id="addFavoriteBtn" class="btn btn-warning btn-lg">â­ Favorilere Ekle</button>
    </div>
{% endif %}

{% if error %}
    <div class="alert alert-danger mt-4" role="alert">
        {{ error }}
    </div>
{% endif %}

<div class="mt-5">
    <h4 class="text-center mb-3">â­ Favori DÃ¶nÃ¼ÅŸtÃ¼rmelerim</h4>
    <ul id="favoritesList" class="list-group list-group-flush text-center"></ul>
</div>

<script>
function loadFavorites() {
    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    const list = document.getElementById('favoritesList');
    list.innerHTML = '';

    if (favorites.length === 0) {
        list.innerHTML = '<li class="list-group-item bg-dark text-light">HenÃ¼z favori yok</li>';
        return;
    }

    favorites.forEach((fav, i) => {
        const li = document.createElement('li');
        li.className = 'list-group-item bg-dark text-light d-flex justify-content-between align-items-center';

        li.innerHTML = `
            <div>
                ğŸ’° <strong>${fav.base}</strong> â†’ <strong>${fav.target}</strong>
            </div>
            <div>
                <form method="POST" action="/" style="display:inline;">
                    <input type="hidden" name="amount" value="1">
                    <input type="hidden" name="base" value="${fav.base}">
                    <input type="hidden" name="target" value="${fav.target}">
                    <button class="btn btn-sm btn-outline-success">Ã‡evir</button>
                </form>
                <button class="btn btn-sm btn-outline-danger" onclick="removeFavorite(${i})">ğŸ—‘</button>
            </div>
        `;
        list.appendChild(li);
    });
}

function addFavorite(base, target) {
    if (!base || !target) return;

    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    if (!favorites.some(f => f.base === base && f.target === target)) {
        favorites.push({ base, target });
        localStorage.setItem('favorites', JSON.stringify(favorites));
        loadFavorites();
        alert(`â­ ${base} â†’ ${target} favorilere eklendi!`);
    } else {
        alert(`âš ï¸ Bu dÃ¶nÃ¼ÅŸÃ¼m zaten favorilerde var.`);
    }
}

function removeFavorite(index) {
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    favorites.splice(index, 1);
    localStorage.setItem('favorites', JSON.stringify(favorites));
    loadFavorites();
}

document.addEventListener('DOMContentLoaded', () => {
    loadFavorites();

    const addBtn = document.getElementById('addFavoriteBtn');
    if (addBtn) {
        addBtn.addEventListener('click', () => {
            const base = document.getElementById('baseInput').value.toUpperCase();
            const target = document.getElementById('targetInput').value.toUpperCase();
            addFavorite(base, target);
        });
    }
});
</script>

{% endblock %}
